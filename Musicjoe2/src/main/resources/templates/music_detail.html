<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layout}">
<section layout:fragment="content">
    <div class="card" style="background: white; border-radius: 24px; padding: 40px; box-shadow: 0 4px 20px rgba(0,0,0,0.05);">
        <h1 th:text="${music.title}" style="font-weight: 800; font-size: 2rem;"></h1>
        <p style="color: #86868B;">ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ: <span th:text="${music.artist}"></span></p>
        
        <div th:if="${youtubeId}" style="margin: 20px 0; border-radius: 15px; overflow: hidden; aspect-ratio: 16/9; background: #000;">
            <iframe style="width: 100%; height: 100%;" 
                    th:src="${'https://www.youtube.com/embed/' + youtubeId}" 
                    frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
            </iframe>
        </div>

        <div th:if="${music.filePath}" style="margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 15px;">
            <h6 style="font-weight: 700;">æ·»ä»˜éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«å†ç”Ÿ</h6>
            <audio controls style="width: 100%;">
                <source th:src="@{|/upload/${music.filePath}|}" type="audio/mpeg">
                ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯å†ç”Ÿã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚
            </audio>
        </div>

        <div style="margin-top: 20px; display: flex; gap: 10px;">
            <a th:href="@{|/music/vote/${music.id}|}" style="display:inline-block; background:#FFF0F0; color:#FF3B30; padding:12px 24px; border-radius:15px; text-decoration:none; font-weight:600;">
                â¤ï¸ ã„ã„ã­ <span th:text="${#lists.size(music.voter)}"></span>
            </a>
            <a href="javascript:void(0);" th:data-uri="@{|/music/delete/${music.id}|}" 
               sec:authorize="hasRole('ADMIN')" class="delete"
               style="display:inline-block; background:#FFEBEB; color:#FF3B30; padding:12px 24px; border-radius:15px; text-decoration:none; font-weight:600; border: 1px solid #FF3B30;">
                ğŸ—‘ï¸ æŠ•ç¨¿ã‚’å‰Šé™¤
            </a>
        </div>

        <div style="margin-top: 40px; border-top: 1px solid #eee; padding-top: 30px;">
            <h4 style="font-weight:700;">ã‚³ãƒ¡ãƒ³ãƒˆ (<span th:text="${#lists.size(music.answerList)}"></span>)</h4>
            <div th:each="answer : ${music.answerList}" style="padding:15px 0; border-bottom:1px solid #f9f9f9;">
                <p th:text="${answer.content}" style="margin-bottom:5px;"></p>
                <small style="color:#86868B;" th:text="${answer.author != null ? answer.author.username : 'åŒ¿å'}"></small>
            </div>
            <form th:action="@{|/answer/create/${music.id}|}" method="post" style="margin-top:20px;">
                <textarea name="content" rows="3" style="width:100%; border-radius:12px; border:1px solid #ddd; padding:15px;" placeholder="ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ®‹ã—ã¦ãã ã•ã„..."></textarea>
                <button type="submit" style="margin-top:10px; background:#007AFF; color:white; border:none; padding:10px 20px; border-radius:10px;">æŠ•ç¨¿</button>
            </form>
        </div>
    </div>

    <script type='text/javascript'>
        const delete_elements = document.getElementsByClassName("delete");
        Array.from(delete_elements).forEach(function(element) {
            element.addEventListener('click', function() {
                if(confirm("æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
                    location.href = this.dataset.uri;
                }
            });
        });
    </script>
</section>
</html>